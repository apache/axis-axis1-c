package org.apache.geronimo.ews.ws4j2ee.toWs.ejb;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.Map;

import org.apache.geronimo.ews.ws4j2ee.context.J2EEWebServiceContext;
import org.apache.geronimo.ews.ws4j2ee.context.SEIOperation;
import org.apache.geronimo.ews.ws4j2ee.toWs.GenerationFault;
import org.apache.geronimo.ews.ws4j2ee.toWs.JavaClassWriter;

/**
 * This class can be used to write the appropriate SessionBean 
 * class for the given port type. 
 * @author Rajith Priyanga
 * @author Srinath Perera
 * @date Nov 26, 2003 
 * 
 */
public class SessionBeanWriter extends JavaClassWriter {
	private String name;


	/**
	 * Constructs a SessionBeanWriter. 
	 * @param portType The port type which contains the details. 
	 * @throws GenerationFault
	 */
	public SessionBeanWriter(J2EEWebServiceContext context) throws GenerationFault {
		super(context,context.getMiscInfo().getEjbbean());	 
	}
	
	
	/**
	 * Returns the complete file name of the source code file which is 
	 * generated by the writer.
	 */
	public String getFileName() {
		name = j2eewscontext.getMiscInfo().getEjbbean();
		String outdir = j2eewscontext.getMiscInfo().getOutPutPath();
		if(!outdir.endsWith("/"))
			outdir = outdir+"/";	
				
		return outdir +"ejb/"+ name.replace('.','/')+ ".java";
	}


	protected void writeAttributes() throws GenerationFault {
	}

	protected void writeConstructors() throws GenerationFault {
	}

	protected void writeMethods() throws GenerationFault {
		String parmlistStr = ""; 
		ArrayList operations = j2eewscontext.getMiscInfo().getSEIOperations();
		for(int i =0;i<operations.size();i++){
			SEIOperation op = (SEIOperation)operations.get(i);
			out.write("\tpublic "+op.getReturnType()+" "+op.getMethodName()+"(");
				
			Map params = op.getParameters();
			Iterator pas = params.keySet().iterator();
			boolean first = true;
			while(pas.hasNext()){
				String name = (String)pas.next();
				String type = (String)params.get(name);
				if(first){ 
					first = false;
					out.write(type + " " +name);
					parmlistStr = parmlistStr + name;
				}else{
					out.write(","+type + " " +name);
					parmlistStr = ","+name;
				}
						
			}
				
			out.write(") throws java.rmi.RemoteException");
			ArrayList faults = op.getFaults();
			for(int j = 0;j<faults.size();j++){
				out.write(","+(String)faults.get(i));
			}
			out.write("{\n");
			out.write("\t}\n");
		}

			

		out.write("\tpublic javax.naming.Context getInitialContext()throws javax.naming.NamingException{\n");
		out.write("\t	java.util.Properties env = new java.util.Properties();\n");
		out.write("\t	env.put(javax.naming.Context.INITIAL_CONTEXT_FACTORY,\"org.jnp.interfaces.NamingContextFactory\");\n");
		out.write("\t	env.put(javax.naming.Context.PROVIDER_URL, \"127.0.0.1:1099\");\n");
		out.write("\t	return new javax.naming.InitialContext(env);\n");
		out.write("\t}\n");
		
		out.write("\tpublic void ejbCreate() {}\n");
		out.write("\tpublic void ejbActivate() throws javax.ejb.EJBException, java.rmi.RemoteException {}\n");
		out.write("\tpublic void ejbPassivate() throws javax.ejb.EJBException, java.rmi.RemoteException {}\n");
		out.write("\tpublic void ejbRemove() throws javax.ejb.EJBException, java.rmi.RemoteException {}\n");
		out.write("\tpublic void setSessionContext(javax.ejb.SessionContext arg0)throws javax.ejb.EJBException, java.rmi.RemoteException {}\n");

	}

	/* (non-Javadoc)
	 * @see org.apache.geronimo.ews.ws4j2ee.toWs.JavaClassWriter#getimplementsPart()
	 */
	protected String getimplementsPart() {
		return " implements javax.ejb.SessionBean";
	}

}
