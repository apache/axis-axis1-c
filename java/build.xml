<?xml version="1.0"?>

<!-- ===================================================================

   Build file for Axis

Notes:
   This is a build file for use with the Jakarta Ant build tool.

Prerequisites:

   jakarta-ant from http://jakarta.apache.org
   xml-xerces  from http://xml.apache.org
   
Build Instructions:
   To build, run

     java org.apache.tools.ant.Main <target>

   on the directory where this file is located with the target you want.

Most useful targets:

 - compile  -> creates the "axis.jar" package in "./build/lib"
 - javadocs -> creates the javadocs in "./build/javadocs"
 - dist     -> creates the complete binary distribution
 - srcdist  -> creates the complete src distribution

Authors:
  Sam Ruby <rubys@us.ibm.com>
  Matthew J. Duftler <duftler@us.ibm.com>


Copyright:
  Copyright (c) 2001 Apache Software Foundation.

==================================================================== -->

<project default="compile" basedir=".">


  <!-- Give user a chance to override without editing this file
       (and without typing -D each time it compiles it) -->
  <property file="build.properties"/>
  <property file="${user.home}/build.properties"/>

  <property name="name" value="axis"/>
  <property name="Name" value="Axis"/>
  <property name="year" value="2001"/>

  <property name="debug" value="true"/>
  <property name="deprecation" value="true"/>

  <property name="src.dir" value="./src"/>
  <property name="docs.dir" value="./docs"/>
  <property name="samples.dir" value="./samples"/>

  <property name="packages" value="org.*"/>

  <property name="build.file" value="build.xml"/>

  <property name="build.dir" value="./build"/>
  <property name="build.dest" value="./build/classes"/>
  <property name="build.lib" value="./build/lib"/>
  <property name="build.samples" value="./build/samples"/>
  <property name="build.javadocs" value="./build/javadocs"/>

  <property name="webapps" value="./webapps"/>

  <property name="dist.dir" value="./axis-1_0"/>

  <!-- =================================================================== -->
  <!-- Determine what dependencies are present                             -->
  <!-- =================================================================== -->
  <path id="classpath">
    <pathelement location="${servlet.jar}"/>
    <pathelement location="${xerces.jar}"/>
    <pathelement path="${java.class.path}"/>
  </path>

  <target name="setenv">
    <mkdir dir="${build.dest}"/>
    <mkdir dir="${build.lib}"/>

    <available property="xerces.present"
      classname="org.apache.xml.serialize.XMLSerializer"
      classpathref="classpath"/>

    <available property="servlet.present"
      classname="javax.servlet.Servlet"
      classpathref="classpath"/>

    <echo message="--- Build environment for ${Name} ---" />
    <echo message="--- Flags (Note: If the {property name} is displayed, "/>
    <echo message="           then the component is not present)" />
    <echo message=""/>
    <echo message="--- Required Libraries ---" />
    <echo message="xerces.present=${xerces.present}" />
    <echo message=""/>
    <echo message="--- Optional Libraries ---" />
    <echo message="servlet.present=${servlet.present}" />
    <echo message=""/>
    <echo message="--- Property values" />
    <echo message="debug=${debug}" />
    <echo message="deprecation=${deprecation}" />

    <uptodate property="javadoc.notrequired"
              targetfile="${build.javadocs}/index.html">
      <srcfiles dir="${src.dir}" includes="**/*.java" />
    </uptodate>
  </target>

  <!-- =================================================================== -->
  <!-- Compiles the source directory                                       -->
  <!-- =================================================================== -->
  <target name="compile" depends="setenv">
    <javac srcdir="${src.dir}" destdir="${build.dest}" debug="${debug}"
      deprecation="${deprecation}"
      classpathref="classpath">
      <exclude name="**/old/**/*" />
      <exclude name="org/apache/axis/handlers/HTTP*" unless="servlet.present"/>
      <exclude name="org/apache/axis/transport/http/*" unless="servlet.present"/>
    </javac>
    <jar jarfile="${build.lib}/${name}.jar" basedir="${build.dest}" />
  </target>

  <!-- =================================================================== -->
  <!-- Compiles the samples                                                -->
  <!-- =================================================================== -->
  <target name="samples" depends="compile">
    <javac srcdir="." destdir="${build.dir}" 
           classpath="${build.lib}/${name}.jar" debug="${debug}">
      <include name="samples/**/*.java" />
      <exclude name="samples/**/*SMTP*.java" unless="smtp.present" />
      <exclude name="**/old/**/*.java" />
    </javac>
    <copy todir="${build.samples}">
      <fileset dir="${samples.dir}"/>
    </copy>
  </target>

  <!-- =================================================================== -->
  <!-- Compiles the test tool(s)                                           -->
  <!-- =================================================================== -->
  <target name="testtools" depends="compile">
    <javac srcdir="." destdir="${build.dir}" debug="${debug}">
      <include name="test/**/*.java" />
    </javac>
  </target>

  <!-- =================================================================== -->
  <!-- Creates the API documentation                                       -->
  <!-- =================================================================== -->

  <target name="javadocs" depends="setenv" unless="javadoc.notrequired">
    <mkdir dir="${build.javadocs}"/>
    <javadoc packagenames="${packages}"
             sourcepath="${src.dir}"
             destdir="${build.javadocs}"
             author="true"
             version="true"
             use="true"
             windowtitle="${Name} API"
             doctitle="${Name}"
             bottom="Copyright &#169; ${year} Apache XML Project. All Rights Reserved."
    />
  </target>

  <!-- =================================================================== -->
  <!-- Creates the binary distribution                                     -->
  <!-- =================================================================== -->
  <target name="dist" depends="compile, javadocs, samples" >
    <mkdir dir="${dist.dir}"/>
    <mkdir dir="${dist.dir}/docs"/>
    <mkdir dir="${dist.dir}/docs/apiDocs"/>
    <mkdir dir="${dist.dir}/lib"/>
    <mkdir dir="${dist.dir}/samples"/>
    <mkdir dir="${dist.dir}/webapps"/>

    <copy todir="${dist.dir}/docs/apiDocs">
      <fileset dir="${build.javadocs}"/>
    </copy>
    <copy todir="${dist.dir}/lib">
      <fileset dir="${build.lib}"/>
    </copy>
    <copy todir="${dist.dir}/samples">
      <fileset dir="${build.samples}"/>
    </copy>
    <copy todir="${dist.dir}/docs">
      <fileset dir="${docs.dir}"/>
    </copy>
    <copy todir="${dist.dir}/webapps">
      <fileset dir="${webapps}"/>
    </copy>

    <copy file="../LICENSE" tofile="${dist.dir}/LICENSE"/>
    <copy file="README" tofile="${dist.dir}/README"/>
    <copy file="ReleaseNotes.html" tofile="${dist.dir}/ReleaseNotes.html"/>
  </target>

  <!-- =================================================================== -->
  <!-- Creates the source distribution                                     -->
  <!-- =================================================================== -->
  <target name="srcdist">
    <copy todir="${dist.dir}/src">
      <fileset dir="${src.dir}"/>
    </copy>

    <copy file="LICENSE" tofile="${dist.dir}/LICENSE"/>
    <copy file="${build.file}" tofile="${dist.dir}/${build.file}"/>
  </target>

  <!-- =================================================================== -->
  <!-- Cleans everything                                                   -->
  <!-- =================================================================== -->
  <target name="clean">
    <delete dir="${build.dir}"/>
    <delete dir="${dist.dir}"/>
  </target>
</project>
